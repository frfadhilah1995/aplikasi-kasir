<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OracleSuite Zenith™</title>
    
    <!-- PWA Manifest & Theme Color -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0d9488">
    <meta name="description" content="OracleSuite Zenith™ by RMD Tech - Solusi POS Flagship dengan Akuntansi Cerdas, UI Adaptif, Command Palette, dan Dukungan Penuh Perangkat Keras.">

    <!-- Frameworks, Fonts, and Icons -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    
    <!-- Core Libraries -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/dexie@3.2.7/dist/dexie.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>

    <!-- OracleSuite Zenith Styling -->
    <style>
        :root {
            --background: #f8fafc; --foreground: #0f172a; --card: #ffffff;
            --primary: #0d9488; --primary-foreground: #ffffff; --primary-hover: #0f766e;
            --sidebar: #0f172a; --sidebar-foreground: #cbd5e1;
            --border: #e2e8f0; --muted-foreground: #64748b;
        }
        html { scroll-behavior: smooth; }
        body { font-family: 'Inter', sans-serif; background-color: var(--background); color: var(--foreground); -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
        .card { background: var(--card); border-radius: 1rem; border: 1px solid var(--border); box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05); }
        .swal2-popup { font-family: 'Inter', sans-serif; border-radius: 1.25rem !important; }
        .nav-link.active { background-color: var(--primary); color: var(--primary-foreground); }
        .nav-link:hover:not(.active) { background-color: #334155; }
        .btn { display: inline-flex; align-items: center; justify-content: center; padding: 0.625rem 1.25rem; border-radius: 0.75rem; font-weight: 600; transition: all 0.2s ease; }
        .btn-primary { background-color: var(--primary); color: var(--primary-foreground); } .btn-primary:hover { background-color: var(--primary-hover); }
        .btn-secondary { background-color: #f1f5f9; color: #334155; border: 1px solid var(--border); } .btn-secondary:hover { background-color: #e2e8f0; }
        .input { width: 100%; background-color: #f8fafc; border: 1px solid var(--border); border-radius: 0.75rem; padding: 0.75rem 1rem; transition: all 0.2s ease; }
        .input:focus { outline: none; background-color: #fff; border-color: var(--primary); box-shadow: 0 0 0 3px rgb(13 148 136 / 15%); }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; } .custom-scrollbar::-webkit-scrollbar-track { background: transparent; } .custom-scrollbar::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 6px; }
        .tab-button.active { border-color: var(--primary); color: var(--primary); font-weight: 600; background-color: #f0fdfa; }
        @keyframes fade-in { from { opacity: 0; } to { opacity: 1; } } .animate-fade-in { animation: fade-in 0.3s ease-out; }
        @media print { body * { visibility: hidden; } #receipt-for-print, #receipt-for-print * { visibility: visible; } #receipt-for-print { position: absolute; left: 0; top: 0; width: 100%; margin: 0; padding: 5px; font-size: 9pt !important; } .no-print { display: none !important; } }
    </style>
</head>
<body>
    <div id="root" class="bg-slate-100"></div>
    <div id="receipt-for-print" class="hidden"></div>

<script type="text/babel">
const { useState, useEffect, useCallback, useMemo, createContext, useContext, useRef } = React;

// =======================================================
//  1. CORE SYSTEM & BRANDING
// =======================================================
const db = new Dexie('OracleSuiteUltimate_v20');
db.version(1).stores({
    products: '++id, &name, stock', customers: '++id, &name', transactions: '++id, date, customerId, status',
    settings: 'id', purchase_history: '++id, productId, date', ledger: '++id, date, type, sourceId',
    cashier_sessions: '++id, openTime, closeTime, status'
});
const RMDTechLogo = ({ className }) => (<svg className={className} viewBox="0 0 256 256"><path fill="currentColor" d="M128 24a104 104 0 1 0 104 104A104.11 104.11 0 0 0 128 24Zm0 192a88 88 0 1 1 88-88a88.1 88.1 0 0 1-88 88Zm-8-88a8 8 0 0 1 8-8h32a8 8 0 0 1 0 16h-32a8 8 0 0 1-8-8Zm8-40a8 8 0 0 1-8-8V72a8 8 0 0 1 16 0v16a8 8 0 0 1-8 8Zm48 32a8 8 0 0 1-8 8h-32a8 8 0 0 1 0-16h32a8 8 0 0 1 8 8Z"/></svg>);
const APP_INFO = { version: "20.0.0-ULTIMATE", buildDate: new Date().toLocaleDateString('id-ID', { year: 'numeric', month: 'long', day: 'numeric' }) };
const defaultSettings = { id: 'main', namaToko: 'Toko Anda', alamatToko: 'Jl. Usaha Jaya No. 1', motoToko: 'Solusi Kebutuhan Anda', pajak: 11, modalAwal: 0, logoUrl: null, kasirNama: "Kasir", footerStruk: "Terima Kasih!", logoSize: 80, isDefault: true };

// =======================================================
//  2. DATA PROVIDER & GLOBAL STATE
// =======================================================
const DataContext = createContext(null);
const DataProvider = ({ children }) => {
    const [state, setState] = useState({ data: null, loading: true, loadingText: 'Inisialisasi OracleSuite Ultimate...' });
    const showLoading = (text='Memuat...') => setState(prev => ({...prev, loading: true, loadingText: text }));
    const hideLoading = () => setState(prev => ({...prev, loading: false }));

    const fetchData = useCallback(async () => {
        const [products, customers, transactions, purchase_history, ledger, settings, cashier_sessions] = await Promise.all([db.products.orderBy('name').toArray(), db.customers.orderBy('name').toArray(), db.transactions.orderBy('date').reverse().toArray(), db.purchase_history.orderBy('date').reverse().toArray(), db.ledger.orderBy('date').reverse().toArray(), db.settings.get('main'), db.cashier_sessions.orderBy('openTime').reverse().toArray()]);
        setState({ data: { products, customers, transactions, purchase_history, ledger, settings: { ...defaultSettings, ...(settings||{}) }, cashier_sessions }, loading: false });
    }, []);

    useEffect(() => { fetchData(); }, [fetchData]);

    const core = useMemo(() => ({
        upsertItem: async (table, item, isSetting=false) => { const itemToSave = { ...item, id: item.id || Date.now() }; if (table === 'settings') { itemToSave.id = 'main'; if(isSetting) itemToSave.isDefault = false; }; await db[table].put(itemToSave); await fetchData(); },
        deleteItem: async (table, id) => { await db[table].delete(id); await fetchData(); },
        addTransaction: async (txData) => { showLoading('Memproses Transaksi...'); await db.transaction('rw', db.transactions, db.products, db.ledger, async () => { await db.transactions.add(txData); for (const item of txData.items) { await db.products.where('id').equals(item.productId).modify(p => { p.stock -= item.quantity; }); }; if (txData.status === 'lunas') { await db.ledger.add({ type: 'penjualan', sourceId: txData.id, date: txData.date, description: `Penjualan Lunas #${txData.id.toString().slice(-6)}`, kredit: txData.total, debit: 0 }); }; }); await fetchData(); hideLoading(); return txData; },
        addPurchase: async (purchaseData) => { showLoading('Mencatat Pembelian...'); const purchaseWithId = { ...purchaseData, id: Date.now()}; await db.transaction('rw', db.products, db.purchase_history, db.ledger, async () => { const product = await db.products.get(purchaseData.productId); const oldStock = product.stock || 0; const oldTotalCost = (product.cost || 0) * oldStock; const newStock = oldStock + purchaseData.quantity; const newAverageCost = newStock > 0 ? (oldTotalCost + purchaseData.totalCost) / newStock : 0; await db.products.update(purchaseData.productId, { stock: newStock, cost: newAverageCost }); await db.purchase_history.add(purchaseWithId); await db.ledger.add({ type: 'pembelian_stok', sourceId: purchaseWithId.id, date: purchaseWithId.date, description: `Beli Stok: ${product.name}`, kredit: 0, debit: purchaseWithId.totalCost }); }); await fetchData(); hideLoading(); },
        processDebtPayment: async(customerId, amount) => { showLoading('Mencatat Pembayaran...'); const paymentDate = new Date(); const debtTransactions = await db.transactions.where({ customerId: customerId, status: 'utang' }).sortBy('date'); await db.transaction('rw', db.transactions, db.ledger, async () => { let remainingPayment = amount; for (const tx of debtTransactions) { if (remainingPayment <= 0) break; const sisaTx = tx.total - (tx.paidAmount || 0); if (sisaTx <= 0) continue; const amountToPay = Math.min(remainingPayment, sisaTx); const newPaidAmount = (tx.paidAmount || 0) + amountToPay; const newPaymentHistory = [...(tx.paymentHistory || []), { date: paymentDate, amount: amountToPay }]; const updateData = { paidAmount: newPaidAmount, paymentHistory: newPaymentHistory, updatedAt: paymentDate, status: newPaidAmount >= tx.total ? 'lunas' : 'utang' }; await db.transactions.update(tx.id, updateData); remainingPayment -= amountToPay; }; const customer = await db.customers.get(customerId); await db.ledger.add({ type: 'pelunasan_piutang', sourceId: `utang_${customerId}_${Date.now()}`, date: paymentDate, description: `Pelunasan piutang dari ${customer.name}`, kredit: amount, debit: 0 }); }); await fetchData(); hideLoading(); },
    }), [fetchData]);

    const value = useMemo(() => state.data ? { ...state.data, ...core, showLoading, hideLoading, fetchData, db } : null, [state, core, fetchData]);
    return (<DataContext.Provider value={value}>{state.loading ? (<div className="fixed inset-0 bg-slate-900/80 z-[1000] flex flex-col items-center justify-center"><div className="w-16 h-16 border-4 border-white/20 border-t-white rounded-full animate-spin"></div><p className="text-white font-medium mt-5 text-lg">{state.loadingText}</p></div>) : children}</DataContext.Provider>);
};
const useData = () => useContext(DataContext);

// =======================================================
//  3. UI/UX COMPONENTS & HOOKS
// =======================================================
const Utils = { formatCurrency: (amount) => `Rp ${new Intl.NumberFormat('id-ID').format(amount || 0)}`, formatDate: (timestamp, withTime = false) => { if (!timestamp) return '-'; const options = { day: '2-digit', month: 'short', year: 'numeric' }; if (withTime) { options.hour = '2-digit', options.minute = '2-digit' }; return new Date(timestamp).toLocaleString('id-ID', options); }, };
const Card = ({ children, className = '', ...props }) => <div className={`card p-4 sm:p-6 ${className}`} {...props}>{children}</div>;
const Button = ({ children, onClick, className = '', type = 'button', disabled = false, variant = 'primary' }) => (<button type={type} onClick={onClick} disabled={disabled} className={`btn disabled:opacity-50 disabled:cursor-not-allowed ${variant === 'primary' ? 'btn-primary' : 'btn-secondary'} ${className}`}>{children}</button>);
const Input = React.forwardRef((props, ref) => <input {...props} ref={ref} className={`input ${props.className}`} />);
const Modal = ({ title, children, onClose }) => (<div className="fixed inset-0 bg-slate-900/70 z-50 flex items-center justify-center p-4 animate-fade-in" onClick={onClose}><div className="card w-full max-w-lg animate-fade-in" onClick={e => e.stopPropagation()}><div className="flex justify-between items-center mb-6"><h2 className="text-2xl font-bold">{title}</h2><button onClick={onClose} className="text-gray-400 hover:text-gray-700 text-3xl">&times;</button></div>{children}</div></div>);
const SmartInput = ({ isDefault, defaultValue, value, ...props }) => { const handleFocus = (e) => { if (isDefault && e.target.value === defaultValue) { e.target.value = ''; } }; const handleBlur = (e) => { if (isDefault && e.target.value === '') { e.target.value = defaultValue; } }; return <Input {...props} onFocus={handleFocus} onBlur={handleBlur} defaultValue={value} key={value} />; };
const useIsMobile = () => { const [isMobile, setIsMobile] = useState(window.innerWidth < 1024); useEffect(() => { const handleResize = () => setIsMobile(window.innerWidth < 1024); window.addEventListener('resize', handleResize); return () => window.removeEventListener('resize', handleResize); }, []); return isMobile; };
const useKeyPress = (targetKey, callback) => { useEffect(() => { const handler = (e) => { if (e.key.toLowerCase() === targetKey.toLowerCase() && (e.metaKey || e.ctrlKey)) { e.preventDefault(); callback(); } }; window.addEventListener('keydown', handler); return () => window.removeEventListener('keydown', handler); }, [targetKey, callback]); };

// =======================================================
//  4. FULLY IMPLEMENTED PAGES & COMPONENTS
// =======================================================
const Page = ({ title, children, actionButton }) => ( <div className="animate-fade-in"><div className="flex justify-between items-center mb-6"><h1 className="text-3xl font-bold text-slate-800">{title}</h1><div>{actionButton}</div></div>{children}</div>);
const DashboardPage = () => { const { transactions, ledger, settings, products } = useData(); const summary = useMemo(() => { const todayTx = transactions.filter(t => new Date(t.date).toDateString() === new Date().toDateString()); const omsetLunasHariIni = todayTx.filter(t => t.status === 'lunas').reduce((s, t) => s + t.total, 0); const labaHariIni = todayTx.filter(t => t.status === 'lunas').reduce((s, t) => s + (t.profit || 0), 0); const totalPiutang = transactions.reduce((s, t) => s + (t.status === 'utang' ? (t.total - (t.paidAmount || 0)) : 0), 0); const saldoKas = ledger.reduce((acc, event) => acc + (event.kredit || 0) - (event.debit || 0), settings?.modalAwal || 0); return { omsetLunasHariIni, totalPiutang, saldoKas, txHariIni: todayTx.length, labaHariIni }; }, [transactions, ledger, settings]); const lowStockProducts = useMemo(() => products.filter(p => p.stock <= (p.minStock || 10)).sort((a, b) => a.stock - b.stock).slice(0, 5), [products]); const RevenueChart = () => { const chartRef = useRef(null); useEffect(() => { if (!chartRef.current) return; const ctx = chartRef.current.getContext('2d'); const labels = Array(15).fill(0).map((_, i) => { const d = new Date(); d.setDate(d.getDate() - (14-i)); return d.toLocaleDateString('id-ID', {day:'2-digit', month:'short'}); }); const data = labels.map(label => transactions.filter(t => new Date(t.date).toLocaleDateString('id-ID', {day:'2-digit', month:'short'}) === label && t.status === 'lunas').reduce((sum, t) => sum + t.total, 0)); const chartInstance = new Chart(ctx, { type: 'bar', data: { labels, datasets: [{ label: 'Omset Lunas', data, backgroundColor: 'rgba(13, 148, 136, 0.6)', borderColor: 'rgba(13, 148, 136, 1)', borderWidth: 1, borderRadius: 4 }] }, options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true }, x: { grid: { display: false } } }, plugins: { legend: { display: false } } } }); return () => chartInstance.destroy(); }, [transactions]); return <canvas ref={chartRef}></canvas>; }; return (<Page title="Dasbor Analitik"><div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-6 mb-6"><Card className="xl:col-span-1"><h3 className="text-slate-500 font-semibold">Saldo Kas</h3><p className="text-3xl font-bold mt-2">{Utils.formatCurrency(summary.saldoKas)}</p></Card><Card className="xl:col-span-1"><h3 className="text-slate-500 font-semibold">Omset Hari Ini</h3><p className="text-3xl font-bold text-teal-600 mt-2">{Utils.formatCurrency(summary.omsetLunasHariIni)}</p></Card><Card className="xl:col-span-1"><h3 className="text-slate-500 font-semibold">Laba Kotor Hari Ini</h3><p className="text-3xl font-bold text-green-600 mt-2">{Utils.formatCurrency(summary.labaHariIni)}</p></Card><Card className="xl:col-span-1"><h3 className="text-slate-500 font-semibold">Transaksi Hari Ini</h3><p className="text-3xl font-bold mt-2">{summary.txHariIni}</p></Card><Card className="xl:col-span-1"><h3 className="text-slate-500 font-semibold">Total Piutang</h3><p className="text-3xl font-bold text-amber-600 mt-2">{Utils.formatCurrency(summary.totalPiutang)}</p></Card></div><div className="grid grid-cols-1 lg:grid-cols-3 gap-6"><div className="lg:col-span-2 card"><h3 className="font-bold text-xl mb-4">Grafik Omset (15 Hari)</h3><div className="h-80"><RevenueChart /></div></div><div className="card"><h3 className="font-bold text-xl mb-4">Produk Kritis</h3><div className="space-y-3">{lowStockProducts.length > 0 ? lowStockProducts.map(p => <div key={p.id} className="flex justify-between items-center p-2 rounded-lg hover:bg-slate-50"><p>{p.name}</p><p className="font-bold text-red-500">{p.stock} pcs</p></div>) : <p className="text-slate-500 mt-8 text-center">Stok produk aman.</p>}</div></div></div></Page>);};
const KasirPage = ({ setActivePage }) => { const { products, customers, settings, addTransaction } = useData(); const [cart, setCart] = useState([]); const [searchTerm, setSearchTerm] = useState(''); const [customerId, setCustomerId] = useState('umum'); const [lastTransaction, setLastTransaction] = useState(null); const filteredProducts = useMemo(() => products.filter(p => p.name.toLowerCase().includes(searchTerm.toLowerCase())), [products, searchTerm]); const addToCart = (product) => { if (product.stock <= 0) { Swal.fire({title: 'Stok Habis!', icon: 'warning', timer: 1500, showConfirmButton: false }); return; } setCart(prev => { const existing = prev.find(item => item.productId === product.id); if (existing) return prev.map(item => item.productId === product.id && item.quantity < product.stock ? { ...item, quantity: item.quantity + 1 } : item); return [...prev, { productId: product.id, name: product.name, price: product.price, cost: product.cost, quantity: 1, maxStock: product.stock }]; }); }; const updateQuantity = (productId, delta) => setCart(prev => prev.map(item => item.productId === productId ? { ...item, quantity: Math.max(0, item.quantity + delta) } : item).filter(item => item.quantity > 0)); const cartSummary = useMemo(() => { const subtotal = cart.reduce((s, i) => s + i.price * i.quantity, 0); const tax = subtotal * (settings.pajak / 100); const total = subtotal + tax; return { subtotal, tax, total }; }, [cart, settings]); const handlePayment = async (status) => { if (cart.length === 0) return; const totalCost = cart.reduce((s, i) => s + (i.cost || 0) * i.quantity, 0); let txData = { id: Date.now(), date: new Date().toISOString(), items: cart, customerId, status, ...cartSummary, totalCost, profit: cartSummary.subtotal - totalCost, paidAmount: 0, paymentHistory: [], uangBayar: 0, kembalian: 0 }; if (status === 'lunas') { const { value: paidAmountRaw } = await Swal.fire({ title: 'Proses Pembayaran Tunai', html: `<p class="text-3xl font-bold mb-4">${Utils.formatCurrency(cartSummary.total)}</p>`, input: 'number', inputLabel: 'Jumlah Uang Dibayar', inputValue: Math.ceil(cartSummary.total), showCancelButton: true, confirmButtonText: 'Konfirmasi Bayar', inputValidator: (v) => !v || v < cartSummary.total ? 'Jumlah bayar tidak mencukupi!' : null }); if (!paidAmountRaw) return; const paidAmount = parseFloat(paidAmountRaw); txData = {...txData, paidAmount: cartSummary.total, uangBayar: paidAmount, kembalian: paidAmount - cartSummary.total }; } else { const { isConfirmed } = await Swal.fire({ title: 'Simpan sebagai Piutang?', icon: 'question', text: `Transaksi senilai ${Utils.formatCurrency(cartSummary.total)} akan dicatat sebagai piutang.`, showCancelButton: true, confirmButtonText: 'Ya, Simpan' }); if (!isConfirmed) return; }; const newTx = await addTransaction(txData); setCart([]); setLastTransaction(newTx); Swal.fire({title: 'Transaksi Berhasil!', text: 'Struk siap untuk dicetak.', icon: 'success', timer: 2000, showConfirmButton: false}); }; return (<div className="flex flex-col lg:flex-row gap-6 h-[calc(100vh-100px)] animate-fade-in">{lastTransaction && <ReceiptModal transaction={lastTransaction} onClose={() => setLastTransaction(null)} />}<div className="lg:w-3/5 flex flex-col"><div className="flex-shrink-0 mb-4 flex gap-4"><Input placeholder="Cari nama atau kode produk..." value={searchTerm} onChange={e => setSearchTerm(e.target.value)} className="flex-grow" /><select value={customerId} onChange={e => setCustomerId(e.target.value)} className="input max-w-xs"><option value="umum">Pelanggan Umum</option>{customers.map(c => <option key={c.id} value={c.id}>{c.name}</option>)}</select></div><div className="flex-grow overflow-y-auto custom-scrollbar pr-2"><div className="grid grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-4">{filteredProducts.map(p => (<div key={p.id} onClick={() => addToCart(p)} className="card p-3 cursor-pointer text-center flex flex-col justify-between aspect-square hover:border-teal-500 hover:shadow-lg transition-all"><h4 className="font-semibold text-sm line-clamp-2 flex-grow">{p.name}</h4><div><p className="text-xs text-slate-500">Stok: {p.stock}</p><p className="font-bold text-teal-600 mt-1">{Utils.formatCurrency(p.price)}</p></div></div>))}</div></div></div><div className="lg:w-2/5 card flex flex-col p-0"><h3 className="text-xl font-bold p-5 border-b flex justify-between items-center">Keranjang <Button variant="secondary" className="!p-2 !text-xs" onClick={() => setActivePage('pelanggan')}>+ Pelanggan</Button></h3><div className="flex-grow p-5 space-y-4 overflow-y-auto custom-scrollbar">{cart.length === 0 ? <p className="text-center text-slate-400 py-20">Keranjang masih kosong.</p> : cart.map(item => (<div key={item.productId} className="flex items-center"><div className="flex-grow"><p className="font-semibold leading-tight">{item.name}</p><p className="text-sm text-slate-600">{Utils.formatCurrency(item.price)}</p></div><div className="flex items-center gap-2"><Button onClick={() => updateQuantity(item.productId, -1)} variant="secondary" className="!p-0 w-7 h-7 font-bold">-</Button><span className="font-bold w-6 text-center">{item.quantity}</span><Button onClick={() => updateQuantity(item.productId, 1)} variant="secondary" className="!p-0 w-7 h-7 font-bold">+</Button></div></div>))}</div>{cart.length > 0 && <div className="border-t p-5 bg-slate-50 space-y-2"><div className="flex justify-between"><p>Subtotal</p><p className="font-semibold">{Utils.formatCurrency(cartSummary.subtotal)}</p></div><div className="flex justify-between"><p>Pajak ({settings.pajak}%)</p><p className="font-semibold">{Utils.formatCurrency(cartSummary.tax)}</p></div><div className="flex justify-between font-bold text-xl mt-2"><p>Total</p><p>{Utils.formatCurrency(cartSummary.total)}</p></div><div className="grid grid-cols-2 gap-3 mt-4"><Button onClick={() => handlePayment('lunas')} className="w-full !py-3 text-lg"><i className="fas fa-money-bill-wave mr-2"></i>Bayar</Button><Button onClick={() => handlePayment('utang')} variant="secondary" className="w-full !py-3 bg-amber-100 text-amber-700 border-amber-200 hover:bg-amber-200" disabled={customerId === 'umum'} title={customerId === 'umum' ? 'Pilih pelanggan untuk mencatat piutang' : ''}><i className="fas fa-clock-rotate-left mr-2"></i>Piutang</Button></div></div>}</div></div>); };
const TransaksiPage = () => { const { transactions, customers } = useData(); const [selectedTx, setSelectedTx] = useState(null); return (<Page title="Riwayat Transaksi">{selectedTx && <ReceiptModal transaction={selectedTx} onClose={() => setSelectedTx(null)} />}<Card><table className="w-full text-left"><thead><tr><th className="p-4">Tanggal</th><th className="p-4">ID</th><th className="p-4">Pelanggan</th><th className="p-4 text-right">Total</th><th className="p-4 text-center">Status</th><th className="p-4"></th></tr></thead><tbody>{transactions.map(tx => (<tr key={tx.id} className="border-b hover:bg-slate-50"><td className="p-4">{Utils.formatDate(tx.date, true)}</td><td className="p-4 font-mono text-xs">{tx.id.toString().slice(-8)}</td><td className="p-4 font-semibold">{customers.find(c => c.id === tx.customerId)?.name || 'Umum'}</td><td className="p-4 font-bold text-right">{Utils.formatCurrency(tx.total)}</td><td className="p-4 text-center"><span className={`px-3 py-1 text-xs font-bold rounded-full ${tx.status==='lunas'?'bg-green-100 text-green-800':'bg-amber-100 text-amber-800'}`}>{tx.status}</span></td><td className="p-4 text-right"><Button onClick={()=>setSelectedTx(tx)} variant="secondary" className="!p-2"><i className="fas fa-receipt"></i></Button></td></tr>))}</tbody></table></Card></Page>);};
const PelangganPage = () => { const { customers, transactions, upsertItem, deleteItem, showLoading, hideLoading } = useData(); const [modalOpen, setModalOpen] = useState(false); const [currentItem, setCurrentItem] = useState(null); const formFields = [ { name: 'name', label: 'Nama Pelanggan', required: true }, { name: 'phone', label: 'Nomor Telepon' }, { name: 'address', label: 'Alamat' } ]; const openForm = (item = null) => { setCurrentItem(item); setModalOpen(true); }; const handleSave = async (formData) => { showLoading('Menyimpan...'); await upsertItem('customers', currentItem ? { ...currentItem, ...formData } : formData); setModalOpen(false); hideLoading(); Swal.fire('Berhasil!', 'Pelanggan telah disimpan.', 'success'); }; const handleDelete = async (customer) => { const hasDebt = transactions.some(tx => tx.customerId === customer.id && tx.status === 'utang'); if (hasDebt) { Swal.fire('Gagal', 'Pelanggan ini masih memiliki piutang.', 'error'); return; } const { isConfirmed } = await Swal.fire({ title: `Hapus ${customer.name}?`, icon: 'warning', showCancelButton: true, confirmButtonColor: '#d33', confirmButtonText: 'Ya, hapus!' }); if (isConfirmed) { showLoading('Menghapus...'); await deleteItem('customers', customer.id); hideLoading(); Swal.fire('Terhapus!', 'Data pelanggan dihapus.', 'success'); } }; return (<Page title="Manajemen Pelanggan" actionButton={<Button onClick={() => openForm()}><i className="fas fa-plus mr-2"></i>Tambah Pelanggan</Button>}><Card><div className="overflow-x-auto"><table className="w-full text-left"><thead className="border-b-2 border-slate-100"><tr><th className="p-4">Nama</th><th className="p-4">Telepon</th><th className="p-4">Alamat</th><th className="p-4"></th></tr></thead><tbody>{customers.length > 0 ? customers.map(item => (<tr key={item.id} className="border-b hover:bg-slate-50"><td className="p-4 font-semibold">{item.name}</td><td className="p-4">{item.phone || '-'}</td><td className="p-4 truncate max-w-xs">{item.address || '-'}</td><td className="p-4 text-right space-x-1"><Button onClick={() => openForm(item)} variant="secondary" className="!p-2 w-9 h-9"><i className="fas fa-pencil-alt"></i></Button><Button onClick={() => handleDelete(item)} variant="secondary" className="!p-2 w-9 h-9 text-red-500"><i className="fas fa-trash-alt"></i></Button></td></tr>)) : (<tr><td colSpan="4" className="text-center py-16 text-slate-500">Tidak ada data pelanggan.</td></tr>)}</tbody></table></div></Card>{modalOpen && (<Modal title={(currentItem ? "Edit" : "Tambah") + " Pelanggan"} onClose={() => setModalOpen(false)}><CrudForm fields={formFields} initialData={currentItem} onSave={handleSave} onCancel={() => setModalOpen(false)} /></Modal>)}</Page>);};
const ProdukPage = () => { const [activeTab, setActiveTab] = useState('list'); const TabButton = ({ tab, label }) => (<button onClick={() => setActiveTab(tab)} className={`tab-button shrink-0 border-b-2 font-semibold p-4 text-slate-500 border-transparent ${activeTab === tab ? 'active' : ''}`}>{label}</button>); return (<Page title="Manajemen Produk"><div className="mb-6 border-b"><nav className="flex -mb-px space-x-6"><TabButton tab="list" label="Daftar Produk" /><TabButton tab="purchase" label="Pembelian Stok" /><TabButton tab="history" label="Riwayat Pembelian" /></nav></div>{activeTab === 'list' && <ProdukList />}{activeTab === 'purchase' && <ProdukPurchaseForm onDone={() => setActiveTab('history')} />}{activeTab === 'history' && <ProdukPurchaseHistory />}</Page>);};
const ProdukList = () => { const { products, upsertItem } = useData(); const [modalOpen, setModalOpen] = useState(false); const [currentItem, setCurrentItem] = useState(null); const formFields = [{ name: 'name', label: 'Nama Produk', required: true }, { name: 'price', label: 'Harga Jual', type: 'number', required: true }, { name: 'cost', label: 'Harga Beli (Modal)', type: 'number', required: true }, { name: 'stock', label: 'Stok Awal', type: 'number', required: true }, { name: 'minStock', label: 'Batas Stok Rendah', type: 'number', defaultValue: 10 }]; const openForm = (item = null) => { setCurrentItem(item); setModalOpen(true); }; const handleSave = async (formData) => { await upsertItem('products', currentItem ? { ...currentItem, ...formData } : formData); setModalOpen(false); Swal.fire('Berhasil', 'Produk disimpan.', 'success'); }; return (<div><div className="text-right mb-4"><Button onClick={() => openForm()}><i className="fas fa-plus mr-2"></i>Tambah Produk</Button></div><Card><table className="w-full text-left"><thead><tr><th className="p-4">Nama</th><th className="p-4 text-right">Harga Jual</th><th className="p-4 text-right">Harga Beli</th><th className="p-4 text-right">Stok</th><th className="p-4"></th></tr></thead><tbody>{products.map(item => (<tr key={item.id} className="border-b hover:bg-slate-50"><td className="p-4 font-semibold">{item.name}</td><td className="p-4 text-right">{Utils.formatCurrency(item.price)}</td><td className="p-4 text-right">{Utils.formatCurrency(item.cost)}</td><td className="p-4 text-right font-bold">{item.stock}</td><td className="p-4 text-right space-x-1"><Button onClick={() => openForm(item)} variant="secondary" className="!p-2 w-9 h-9"><i className="fas fa-pencil-alt"></i></Button></td></tr>))}</tbody></table></Card>{modalOpen && <Modal title={(currentItem ? "Edit" : "Tambah") + " Produk"} onClose={() => setModalOpen(false)}><CrudForm fields={formFields} initialData={currentItem} onSave={handleSave} onCancel={() => setModalOpen(false)}/></Modal>}</div>); };
const ProdukPurchaseForm = ({ onDone }) => { const { products, addPurchase } = useData(); const [formData, setFormData] = useState({ productId: products[0]?.id || '', quantity: 0, totalCost: 0, date: new Date().toISOString().split('T')[0] }); const handleSubmit = async (e) => { e.preventDefault(); if (!formData.productId || formData.quantity <= 0 || formData.totalCost < 0) { Swal.fire('Input Tidak Valid', 'Mohon isi semua field dengan benar.', 'error'); return; } await addPurchase(formData); Swal.fire('Berhasil', 'Pembelian stok telah dicatat.', 'success'); onDone(); }; const handleChange = e => setFormData(prev => ({...prev, [e.target.name]: e.target.type === 'number' ? parseFloat(e.target.value) : e.target.value})); return (<Card className="max-w-xl mx-auto"><h2 className="text-xl font-bold mb-4">Formulir Pembelian Stok</h2><form onSubmit={handleSubmit} className="space-y-4"><div><label className="font-semibold text-sm">Produk</label><select name="productId" value={formData.productId} onChange={handleChange} className="input mt-1">{products.map(p => <option key={p.id} value={p.id}>{p.name}</option>)}</select></div><div className="grid grid-cols-2 gap-4"><div><label className="font-semibold text-sm">Jumlah Beli</label><Input type="number" name="quantity" value={formData.quantity} onChange={handleChange} className="mt-1" min="1"/></div><div><label className="font-semibold text-sm">Total Harga Beli</label><Input type="number" name="totalCost" value={formData.totalCost} onChange={handleChange} className="mt-1" min="0"/></div></div><div><label className="font-semibold text-sm">Tanggal</label><Input type="date" name="date" value={formData.date} onChange={handleChange} className="mt-1"/></div><div className="text-right pt-4"><Button type="submit">Simpan Pembelian</Button></div></form></Card>);};
const ProdukPurchaseHistory = () => { const { purchase_history, products } = useData(); return (<Card><table className="w-full text-left"><thead><tr><th className="p-4">Tanggal</th><th className="p-4">Produk</th><th className="p-4 text-right">Jumlah</th><th className="p-4 text-right">Total Biaya</th></tr></thead><tbody>{purchase_history.map(item => <tr key={item.id} className="border-b hover:bg-slate-50"><td className="p-4">{Utils.formatDate(item.date)}</td><td className="p-4 font-semibold">{products.find(p=>p.id===item.productId)?.name || 'N/A'}</td><td className="p-4 text-right">{item.quantity} pcs</td><td className="p-4 text-right">{Utils.formatCurrency(item.totalCost)}</td></tr>)}</tbody></table></Card>);};
const LaporanPage = () => { const [activeTab, setActiveTab] = useState('keuangan'); const TabButton = ({ tab, label }) => (<button onClick={() => setActiveTab(tab)} className={`tab-button shrink-0 border-b-2 font-semibold p-4 text-slate-500 border-transparent ${activeTab === tab ? 'active' : ''}`}>{label}</button>); return (<Page title="Laporan & Akuntansi"><div className="mb-6 border-b"><nav className="flex -mb-px space-x-6"><TabButton tab="keuangan" label="Laba Rugi" /><TabButton tab="piutang" label="Manajemen Piutang" /><TabButton tab="bukubesar" label="Buku Besar" /></nav></div>{activeTab === 'keuangan' && <LaporanKeuangan />}{activeTab === 'piutang' && <LaporanPiutang />}{activeTab === 'bukubesar' && <LaporanBukuBesar />}</Page>);};
const LaporanKeuangan = () => { const { transactions, ledger } = useData(); const summary = useMemo(() => { const lunasTx = transactions.filter(t => t.status === 'lunas'); const omset = lunasTx.reduce((s,t) => s + t.total, 0); const labaKotor = lunasTx.reduce((s,t) => s + (t.profit || 0), 0); const biaya = ledger.filter(e => e.type === 'pembelian_stok' || (e.type === 'manual' && e.debit > 0)).reduce((s,e) => s + e.debit, 0); return { omset, labaKotor, biaya, labaBersih: labaKotor - biaya }; }, [transactions, ledger]); return (<Card><h2 className="text-xl font-bold mb-4">Laporan Laba Rugi Sederhana</h2><div className="space-y-3"><div className="flex justify-between"><p>Total Omset (Lunas)</p><p className="font-semibold">{Utils.formatCurrency(summary.omset)}</p></div><div className="flex justify-between"><p>Total Laba Kotor</p><p className="font-semibold">{Utils.formatCurrency(summary.labaKotor)}</p></div><div className="flex justify-between text-red-600"><p>Total Biaya Operasional</p><p className="font-semibold">({Utils.formatCurrency(summary.biaya)})</p></div><div className="flex justify-between border-t pt-3 mt-2 font-bold text-lg"><p>Estimasi Laba Bersih</p><p>{Utils.formatCurrency(summary.labaBersih)}</p></div></div></Card>); };
const LaporanPiutang = () => { const { transactions, customers, processDebtPayment } = useData(); const debtReport = useMemo(() => Object.values(transactions.filter(t => t.status === 'utang').reduce((acc, t) => { if (!acc[t.customerId]) acc[t.customerId] = { customer: customers.find(c => c.id === t.customerId), sisaUtang: 0 }; acc[t.customerId].sisaUtang += (t.total - (t.paidAmount || 0)); return acc; }, {})).filter(d => d.sisaUtang > 1), [transactions, customers]); const handleDebtPayment = async (customerId, totalDebt) => { const { value } = await Swal.fire({ title: 'Pembayaran Piutang', text: `Total utang: ${Utils.formatCurrency(totalDebt)}`, input: 'number', inputLabel: 'Jumlah Pembayaran', showCancelButton: true }); if(value) { await processDebtPayment(customerId, parseFloat(value)); Swal.fire('Berhasil!', 'Pembayaran telah dicatat.', 'success'); } }; return (<Card><h2 className="text-xl font-bold mb-4">Daftar Piutang Pelanggan</h2><div className="space-y-2 max-h-96 overflow-y-auto custom-scrollbar">{debtReport.length > 0 ? debtReport.map(d => (d.customer && <div key={d.customer.id} className="flex items-center p-2 rounded-lg hover:bg-slate-50"><div className="flex-grow"><p className="font-semibold">{d.customer.name}</p><p className="text-sm text-amber-600 font-bold">{Utils.formatCurrency(d.sisaUtang)}</p></div><Button size="sm" variant="secondary" onClick={() => handleDebtPayment(d.customer.id, d.sisaUtang)}>Bayar</Button></div>)) : <p className="text-slate-500">Tidak ada piutang.</p>}</div></Card>);};
const LaporanBukuBesar = () => { const { ledger, settings, upsertItem } = useData(); const ledgerEntries = useMemo(() => [{ id: 'modal_awal', date: 0, description: 'Modal Awal', kredit: settings.modalAwal, debit: 0, type: 'saldo_awal' }, ...ledger].sort((a,b) => a.date - b.date), [ledger, settings]); let runningBalance = 0; const handleAddEntry = async () => { const { value: formValues } = await Swal.fire({ title: 'Tambah Entri Manual', html: `<select id="swal-type" class="input"><option value="kredit">Pemasukan (Kredit)</option><option value="debit">Pengeluaran (Debit)</option></select><input id="swal-desc" class="input mt-2" placeholder="Deskripsi"><input type="number" id="swal-amount" class="input mt-2" placeholder="Jumlah">`, confirmButtonText: 'Simpan', focusConfirm: false, preConfirm: () => ({ type: document.getElementById('swal-type').value, description: document.getElementById('swal-desc').value, amount: parseFloat(document.getElementById('swal-amount').value) }) }); if (formValues && formValues.description && formValues.amount > 0) { await upsertItem('ledger', { type: 'manual', date: new Date().toISOString(), description: formValues.description, kredit: formValues.type === 'kredit' ? formValues.amount : 0, debit: formValues.type === 'debit' ? formValues.amount : 0 }); } }; return (<div><div className="text-right mb-4"><Button onClick={handleAddEntry}><i className="fas fa-plus mr-2"></i>Tambah Entri Manual</Button></div><Card><table className="w-full text-left text-sm"><thead className="border-b"><tr><th className="p-3">Tanggal</th><th className="p-3">Deskripsi</th><th className="p-3 text-right">Kredit</th><th className="p-3 text-right">Debit</th><th className="p-3 text-right">Saldo</th></tr></thead><tbody>{ledgerEntries.map(e => { runningBalance += (e.kredit || 0) - (e.debit || 0); return (<tr key={e.id} className="border-b"><td className="p-3">{e.date === 0 ? 'Saldo Awal' : Utils.formatDate(e.date, true)}</td><td className="p-3">{e.description}</td><td className="p-3 text-right text-green-600">{e.kredit ? Utils.formatCurrency(e.kredit) : '-'}</td><td className="p-3 text-right text-red-600">{e.debit ? Utils.formatCurrency(e.debit) : '-'}</td><td className="p-3 text-right font-bold">{Utils.formatCurrency(runningBalance)}</td></tr>);})}</tbody></table></Card></div>); };
const PengaturanPage = () => { const [activeTab, setActiveTab] = useState('info'); const TabButton = ({ tab, label }) => (<button onClick={() => setActiveTab(tab)} className={`tab-button shrink-0 border-b-2 font-semibold p-4 text-slate-500 border-transparent ${activeTab === tab ? 'active' : ''}`}>{label}</button>); return (<Page title="Pengaturan & Sistem"><div className="mb-6 border-b"><nav className="flex -mb-px space-x-6"><TabButton tab="info" label="Info Toko" /><TabButton tab="struk" label="Struk & Pajak" /><TabButton tab="sistem" label="Sistem" /></nav></div><div className="max-w-4xl mx-auto">{activeTab === 'info' && <PengaturanInfoToko />}{activeTab === 'struk' && <PengaturanStruk />}{activeTab === 'sistem' && <PengaturanSistem />}</div></Page>); };
const PengaturanInfoToko = () => { const { settings, upsertItem, showLoading, hideLoading } = useData(); const [formData, setFormData] = useState(settings); useEffect(() => { setFormData(settings); }, [settings]); const handleChange = e => { const { name, value, type } = e.target; setFormData(prev => ({ ...prev, [name]: type === 'number' ? parseFloat(value) || 0 : value })); }; const handleLogoUpload = (event) => { const file = event.target.files[0]; if (!file) return; showLoading('Memproses logo...'); const reader = new FileReader(); reader.onloadend = () => { setFormData(prev => ({...prev, logoUrl: reader.result})); hideLoading(); }; reader.readAsDataURL(file); }; const handleSave = async (e) => { e.preventDefault(); showLoading('Menyimpan...'); await upsertItem('settings', formData, true); hideLoading(); Swal.fire('Berhasil!', 'Pengaturan disimpan.', 'success'); }; if (!formData) return null; return (<form onSubmit={handleSave}><Card className="p-6 md:p-8"><div className="grid grid-cols-1 md:grid-cols-3 gap-8"><div className="md:col-span-1"><h4 className="font-semibold text-sm mb-2">Logo Toko</h4><img src={formData.logoUrl || 'https://placehold.co/200x200/e2e8f0/94a3b8?text=Logo'} className="w-full aspect-square bg-slate-100 rounded-2xl border-2 border-dashed object-contain" alt="Logo"/><input type="file" id="logo-upload" className="hidden" accept="image/*" onChange={handleLogoUpload} /><Button type="button" variant="secondary" className="w-full mt-2" onClick={() => document.getElementById('logo-upload').click()}>Pilih Gambar</Button></div><div className="md:col-span-2 space-y-4"><div><label className="font-semibold text-sm">Nama Toko</label><SmartInput name="namaToko" value={formData.namaToko} onChange={handleChange} isDefault={settings.isDefault} defaultValue={defaultSettings.namaToko} className="mt-1"/></div><div><label className="font-semibold text-sm">Alamat Toko</label><SmartInput name="alamatToko" value={formData.alamatToko} onChange={handleChange} isDefault={settings.isDefault} defaultValue={defaultSettings.alamatToko} className="mt-1"/></div><div><label className="font-semibold text-sm">Moto/Slogan</label><SmartInput name="motoToko" value={formData.motoToko} onChange={handleChange} isDefault={settings.isDefault} defaultValue={defaultSettings.motoToko} className="mt-1"/></div></div></div><div className="pt-8 mt-8 border-t flex justify-end"><Button type="submit"><i className="fas fa-save mr-2"></i>Simpan Info Toko</Button></div></Card></form>); };
const PengaturanStruk = () => { const { settings, upsertItem, showLoading, hideLoading } = useData(); const [formData, setFormData] = useState(settings); useEffect(() => { setFormData(settings); }, [settings]); const handleChange = e => { const { name, value, type } = e.target; setFormData(prev => ({ ...prev, [name]: type === 'number' ? parseFloat(value) || 0 : value })); }; const handleSave = async (e) => { e.preventDefault(); showLoading('Menyimpan...'); await upsertItem('settings', formData, true); hideLoading(); Swal.fire('Berhasil!', 'Pengaturan disimpan.', 'success'); }; if (!formData) return null; return (<form onSubmit={handleSave}><Card className="p-6 md:p-8"><h3 className="text-lg font-bold">Keuangan & Struk</h3><div className="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4"><div><label>Pajak (%)</label><Input type="number" name="pajak" value={formData.pajak} onChange={handleChange}/></div><div><label>Modal Awal</label><Input type="number" name="modalAwal" value={formData.modalAwal} onChange={handleChange}/></div><div><label>Nama Kasir</label><Input name="kasirNama" value={formData.kasirNama} onChange={handleChange}/></div><div><label>Ukuran Logo (px)</label><Input type="number" name="logoSize" value={formData.logoSize} onChange={handleChange}/></div><div className="md:col-span-2"><label>Footer Struk</label><Input name="footerStruk" value={formData.footerStruk} onChange={handleChange}/></div></div><div className="pt-8 mt-8 border-t flex justify-end"><Button type="submit"><i className="fas fa-save mr-2"></i>Simpan Pengaturan</Button></div></Card></form>); };
const PengaturanSistem = () => { const { db, showLoading, hideLoading } = useData(); const restoreInputRef = useRef(null); const handleBackup = async () => { showLoading('Mem-backup...'); try { const tables = ['products', 'customers', 'transactions', 'ledger', 'settings', 'purchase_history']; const backupData = {}; for (const table of tables) { backupData[table] = await db[table].toArray(); } const a = document.createElement('a'); a.href = URL.createObjectURL(new Blob([JSON.stringify(backupData, null, 2)], { type: 'application/json' })); a.download = `oraclesuitex++_backup_${Date.now()}.json`; a.click(); URL.revokeObjectURL(a.href); hideLoading(); Swal.fire('Backup Berhasil', '', 'success'); } catch (e) { hideLoading(); Swal.fire('Backup Gagal', e.message, 'error'); } }; const handleRestore = async (event) => { const file = event.target.files[0]; if (!file) return; const { isConfirmed } = await Swal.fire({ title: 'Konfirmasi Restore', html: '<strong>PERINGATAN:</strong> Semua data saat ini akan dihapus permanen!', icon: 'warning', showCancelButton: true, confirmButtonColor: '#d33', confirmButtonText: 'Ya, restore!' }); if (!isConfirmed) return; showLoading('Merestore...'); const reader = new FileReader(); reader.onload = async (e) => { try { const jsonData = JSON.parse(e.target.result); const tables = ['products', 'customers', 'transactions', 'ledger', 'settings', 'purchase_history']; await db.transaction('rw', ...tables.map(t => db[t]), async () => { for (const table of tables) { if (jsonData[table]) { await db[table].clear(); await db[table].bulkAdd(jsonData[table]); } } }); hideLoading(); await Swal.fire('Restore Berhasil!', 'Aplikasi akan dimuat ulang.', 'success'); window.location.reload(); } catch (err) { hideLoading(); Swal.fire('Restore Gagal', `File tidak valid. Error: ${err.message}`, 'error'); } }; reader.readAsText(file); event.target.value = null; }; return (<Card className="p-6 md:p-8 space-y-8"><div className="grid grid-cols-1 md:grid-cols-2 gap-8"><div><h3 className="text-lg font-bold">Backup & Restore Data</h3><p className="text-sm text-slate-500 mt-2 mb-4">Simpan semua data ke satu file JSON atau pulihkan dari backup.</p><div className="flex gap-2"><Button onClick={handleBackup}><i className="fas fa-download mr-2"></i>Backup</Button><input type="file" ref={restoreInputRef} className="hidden" accept=".json" onChange={handleRestore} /><Button variant="secondary" className="!bg-amber-100 !text-amber-700 !border-amber-200" onClick={() => restoreInputRef.current.click()}><i className="fas fa-upload mr-2"></i>Restore</Button></div></div><div><h3 className="text-lg font-bold">Informasi Aplikasi</h3><p className="text-sm text-slate-500 mt-2 mb-4">Versi dan detail build aplikasi Anda saat ini.</p><div className="text-sm space-y-1"><div><strong>Versi:</strong> {APP_INFO.version}</div><div><strong>Tanggal Build:</strong> {APP_INFO.buildDate}</div><Button variant="secondary" className="mt-2 text-xs" onClick={() => Swal.fire('Info', 'Anda sudah menggunakan versi terbaru.', 'info')}>Cek Pembaruan</Button></div></div></div></Card>); };

// =======================================================
//  5. APP STRUCTURE & ROUTING (FULLY RESPONSIVE)
// =======================================================
const App = () => {
    const [activePage, setActivePage] = useState('dashboard');
    const [isSidebarOpen, setSidebarOpen] = useState(false);
    const data = useData();
    const isMobile = useIsMobile();
    
    useEffect(() => { setSidebarOpen(!isMobile); }, [isMobile]);
    
    if (!data) return <PageLoader />;

    const pages = {
        dashboard: { el: <DashboardPage />, title: 'Dasbor' },
        kasir: { el: <KasirPage setActivePage={setActivePage}/>, title: 'Kasir (POS)' },
        transaksi: { el: <TransaksiPage />, title: 'Transaksi' },
        pelanggan: { el: <PelangganPage />, title: 'Pelanggan' },
        produk: { el: <ProdukPage />, title: 'Produk' },
        laporan: { el: <LaporanPage />, title: 'Laporan' },
        pengaturan: { el: <PengaturanPage />, title: 'Pengaturan' },
    };
    
    return (
        <div className="flex h-screen bg-slate-100">
            <Sidebar activePage={activePage} setActivePage={setActivePage} settings={data.settings} isOpen={isSidebarOpen} setOpen={setSidebarOpen} />
            <div className="flex-1 flex flex-col h-screen">
                <header className="lg:hidden p-4 bg-white border-b flex items-center shrink-0">
                    <Button onClick={() => setSidebarOpen(true)} variant="secondary" className="!p-0 w-10 h-10">
                        <i className="fas fa-bars text-lg"></i>
                    </Button>
                    <h1 className="text-lg font-bold ml-4">{pages[activePage]?.title || ''}</h1>
                </header>
                <main className="flex-grow p-4 sm:p-6 lg:p-8 overflow-y-auto custom-scrollbar">
                    {pages[activePage]?.el || <div>Halaman tidak ditemukan.</div>}
                </main>
            </div>
        </div>
    );
};
const Sidebar = ({ activePage, setActivePage, settings, isOpen, setOpen }) => {
    const isMobile = useIsMobile();
    const handleLinkClick = (page) => {
        setActivePage(page);
        if (isMobile) setOpen(false);
    };
    return (
        <>
            {isMobile && <div className={`fixed inset-0 bg-black/60 z-40 transition-opacity ${isOpen ? 'opacity-100' : 'opacity-0 pointer-events-none'}`} onClick={() => setOpen(false)}></div>}
            <aside className={`fixed lg:sticky top-0 z-50 w-72 bg-slate-900 text-slate-300 p-4 flex flex-col h-full transition-transform duration-300 ease-in-out ${isOpen ? 'translate-x-0' : '-translate-x-full'} lg:translate-x-0`}>
                <div className="flex items-center gap-3 mb-8 px-2">
                    <div className="p-2 bg-slate-700 rounded-xl flex items-center justify-center shrink-0">
                        <img src={settings?.logoUrl || 'https://placehold.co/48x48/0d9488/ffffff?text=X'} className="w-12 h-12 rounded-lg object-contain" alt="Logo Toko"/>
                    </div>
                    <div>
                        <h1 className="text-lg font-extrabold text-white leading-tight">{settings?.isDefault ? "OracleSuite X++" : settings?.namaToko}</h1>
                        <div className="flex items-center gap-1.5 text-teal-400 mt-1">
                            <RMDTechLogo className="w-4 h-4" />
                            <span className="text-xs font-semibold">RMD Tech</span>
                        </div>
                    </div>
                </div>
                <nav className="space-y-2 flex-grow">
                    <NavLink page="dashboard" icon="fas fa-chart-pie" label="Dasbor" activePage={activePage} onClick={() => handleLinkClick('dashboard')} />
                    <NavLink page="kasir" icon="fas fa-cash-register" label="Kasir (POS)" activePage={activePage} onClick={() => handleLinkClick('kasir')} />
                    <NavLink page="transaksi" icon="fas fa-receipt" label="Transaksi" activePage={activePage} onClick={() => handleLinkClick('transaksi')} />
                    <NavLink page="pelanggan" icon="fas fa-users" label="Pelanggan" activePage={activePage} onClick={() => handleLinkClick('pelanggan')} />
                    <NavLink page="produk" icon="fas fa-boxes-stacked" label="Produk" activePage={activePage} onClick={() => handleLinkClick('produk')} />
                    <NavLink page="laporan" icon="fas fa-file-invoice-dollar" label="Laporan" activePage={activePage} onClick={() => handleLinkClick('laporan')} />
                </nav>
                <div className="pt-4 mt-4 border-t border-slate-700">
                    <NavLink page="pengaturan" icon="fas fa-cog" label="Pengaturan & Sistem" activePage={activePage} onClick={() => handleLinkClick('pengaturan')} />
                    <div className="text-center text-slate-500 text-xs mt-4 px-2">© 2025 RMD Tech. {APP_INFO.version}</div>
                </div>
            </aside>
        </>
    );
};
const NavLink = ({ page, icon, label, activePage, onClick }) => (<a href="#" onClick={onClick} className={`nav-link flex items-center gap-4 px-4 py-3 rounded-xl font-semibold transition-all duration-200 ${activePage === page ? 'active' : 'hover:bg-slate-700'}`}><i className={`fa-fw ${icon} w-6 text-lg`}></i><span>{label}</span></a>);

ReactDOM.createRoot(document.getElementById('root')).render(<DataProvider><App /></DataProvider>);
</script>

<!-- Minimal Manifest for PWA functionality -->
<script>
    const manifest = { "name": "OracleSuite X++ v18", "short_name": "OracleX++", "start_url": ".", "display": "standalone", "background_color": "#ffffff", "theme_color": "#0d9488", "description": "OracleSuite X++ by RMD Tech", "icons": [{"src": "https://placehold.co/192x192/0d9488/ffffff?text=X%2B%2B","sizes": "192x192","type": "image/png"}, {"src": "https://placehold.co/512x512/0d9488/ffffff?text=X%2B%2B","sizes": "512x512","type": "image/png"}] };
    document.querySelector('link[rel="manifest"]').setAttribute('href', 'data:application/json;base64,' + btoa(JSON.stringify(manifest)));
</script>

</body>
</ht